"use strict";angular.module("frontendApp",["ui.router","ui.bootstrap"]),angular.module("frontendApp").config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("home",{templateUrl:"views/home.html",controller:"HomeCtrl",controllerAs:"vm",url:"/home"}).state("writeblog",{templateUrl:"views/writeblog.html",url:"/writeblog"}).state("blogpost",{templateUrl:"views/blogpost.html",url:"/blogpost/:id",controller:"BlogpostCtrl",controllerAs:"vm"}),b.otherwise("/home")}]),angular.module("frontendApp").controller("HomeCtrl",["blogService",function(a){var b=this;a.getAllBlogs().then(function(a){a.success&&(b.blogs=a.blogs,angular.forEach(b.blogs,function(a,b){a.tags&&(a.tags=a.tags.split(","))}))})}]),angular.module("frontendApp").controller("HeaderCtrl",["AuthService","$window","$state",function(a,b,c){var d=this,e=b.localStorage;d.loginOn=!1,e.getItem("user")?(d.hasAccess=!0,d.loginButton=!1,d.user=JSON.parse(e.getItem("user"))):(d.loginButton=!0,d.hasAccess=!1,d.user=""),d.openLogin=function(){d.loginOn=!0},d.closeLogin=function(){d.loginOn=!d.loginOn},d.login=function(b,f){a.login(b,f).then(function(a){console.log(a),a.success&&(d.closeLogin(),d.loginButton=!d.loginButton,d.hasAccess=!0,e.setItem("user",JSON.stringify(a.user)),d.user=JSON.parse(e.getItem("user")),"admin"==a.user.role&&c.go("writeblog"))})},d.logout=function(){a.logout(),d.loginButton=!0,d.hasAccess=!1,c.go("home")}}]),angular.module("frontendApp").service("AuthService",["$q","$http",function(a,b){function c(c,d){var e={email:c,password:d},f=a.defer();return b({method:"POST",url:"http://localhost:3000/login",data:e,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}}).success(function(a){f.resolve(a)}).error(function(a){f.reject(a)}),f.promise}function d(){return!(void 0===f.getItem("user")||null===f.getItem("user"))}function e(){f.clear()}var f=window.localStorage,g={};return g.login=c,g.logout=e,g.isAuthenticated=d,g}]),angular.module("frontendApp").controller("BlogCtrl",["blogService","$window","$state",function(a,b,c){var d=this,e=b.localStorage;d.createBlog=function(b,d,f){var g=JSON.parse(e.getItem("user")).firstname+" "+JSON.parse(e.getItem("user")).lastname,h=new Date;a.createBlog(b,d,f,g,h).then(function(a){console.log(a),a.success&&c.go("home")})}}]),angular.module("frontendApp").service("blogService",["$q","$http",function(a,b){function c(c,d,e,f,g){var h={title:c,author:f,tags:d,content:e,date:g},i=a.defer();return b({method:"POST",url:"http://localhost:3000/writeblog",data:h,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}}).success(function(a){i.resolve(a)}).error(function(a){i.reject(a)}),i.promise}function d(){var c=a.defer();return b({method:"GET",url:"http://localhost:3000/getallblogs"}).success(function(a){c.resolve(a)}).error(function(a){c.reject(a)}),c.promise}function e(c){var d={id:c},e=a.defer();return b({method:"POST",url:"http://localhost:3000/getblogbyid",data:d,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}}).success(function(a){e.resolve(a)}).error(function(a){e.reject(a)}),e.promise}function f(c,d,e){var f={id:d,user:e,body:c,date:new Date},g=a.defer();return b({method:"POST",url:"http://localhost:3000/postcomment",data:f,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}}).success(function(a){g.resolve(a)}).error(function(a){g.reject(a)}),g.promise}function g(c,d,e,f){var g={blogid:c,id:e,user:f,reply:d,date:new Date},h=a.defer();return b({method:"POST",url:"http://localhost:3000/replytocomment",data:g,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}}).success(function(a){h.resolve(a)}).error(function(a){h.reject(a)}),h.promise}var h={};return h.createBlog=c,h.getAllBlogs=d,h.getBlogById=e,h.postComment=f,h.replyToComment=g,h}]),angular.module("frontendApp").directive("orderByObject",function(){}),angular.module("frontendApp").filter("orderObjectBy",function(){return function(a,b,c){var d=[];return angular.forEach(a,function(a){d.push(a)}),d.sort(function(a,c){return a[b]>c[b]?1:-1}),c&&d.reverse(),d}}),angular.module("frontendApp").directive("blogpost",function(){return{scope:!0}}),angular.module("frontendApp").controller("BlogpostCtrl",["blogService","$stateParams",function(a,b){var c=this,d=window.localStorage;c.isCollapsed=!0,c.id=b.id,d.getItem("user")?(c.user=JSON.parse(d.getItem("user")),c.hasAccess=!0):c.hasAccess=!1,a.getBlogById(c.id).then(function(a){a.success&&(c.blog=a.blog,c.blog.tags=c.blog.tags.split(","))}),c.postComment=function(b){c.comment="",a.postComment(b,c.id,c.user.firstname+""+c.user.lastname).then(function(a){a.success&&(c.blog=a.blog,c.blog.tags=c.blog.tags.split(","))})},c.replyComment=function(b,d){c.comment="",a.replyToComment(c.id,b,d,c.user.firstname+""+c.user.lastname).then(function(a){a.success&&(c.blog=a.blog,c.blog.tags=c.blog.tags.split(","))})}}]),angular.module("frontendApp").run(["$templateCache",function(a){a.put("views/blogpost.html",'<div class="row main-wrapper"> <div class="col-md-8"> <div class="single-post-wrapper"> <div class="post"> <div class="post"> <h2 class="post-title">{{vm.blog.title}}</h2> <div class="post-meta"> <span>Created at:</span> <span class="post-date">{{vm.blog.date | date}}</span> </div> <div ng-if="vm.blog.tags" class="post-tags"> <span ng-repeat="tag in vm.blog.tags">{{tag}}</span> </div> <div class="post-content"> <p>{{vm.blog.content}}</p> </div> <!--<div class="post-more">\n						<a class="btn btn-primary read-more" ng-click="open()">Read More</a>\n					</div>--> </div> </div> </div> <div class="comment-wrapper"> <div class="post-comment"> <form name="commentForm" novalidate ng-submit="commentForm.$valid && vm.postComment(vm.comment);"> <div class="userPic"> <div class="pull-left image"> <img src="http://bootdey.com/img/Content/user_1.jpg" class="img-circle avatar" alt="user profile image"> </div> <div class="pull-left name"> <h1 ng-if="vm.hasAccess">{{vm.user.firstname }} {{vm.user.lastname}}</h1> <h1 ng-if="!vm.hasAccess">Please login to leave a comment</h1> </div> </div> <div class="userComment"> <textarea required class="comment" ng-model="vm.comment" placeholder="Leave a comment" ng-readonly="!vm.hasAccess"></textarea> <button ng-disabled="!vm.hasAccess" type="submit" class="btn btn-success green pull-right"><i class="fa fa-share"></i> submit</button> </div> </form> </div> <div class="panel panel-white post panel-shadow" ng-repeat=" comment in vm.blog.comments | orderObjectBy:\'date\':true"> <div class="post-heading"> <div class="pull-left image"> <img src="http://bootdey.com/img/Content/user_1.jpg" class="img-circle avatar" alt="user profile image "> </div> <div class="pull-left meta"> <div class="title h5"> <a href="#"><b>{{comment.user}}</b></a> made a post. </div> <h6 class="text-muted time">{{comment.date}}</h6> </div> </div> <div class="post-description"> <p>{{comment.body}}</p> <div class="stats"> <a href="#" class="btn btn-default stat-item"> <i class="fa fa-thumbs-up icon"></i>2 </a> <a href="#" class="btn btn-default stat-item"> <i class="fa fa-thumbs-down icon"></i>12 </a> <a class="btn btn-primary" data-toggle="collapse" data-target="#{{$index}}" class="accordion-toggle"> REPLY </a> <div class="collapse" id="{{$index}}"> <div class="post-comment"> <form name="replyForm" novalidate ng-submit="replyForm.$valid && vm.replyComment(vm.reply , comment._id);"> <div class="userPic"> <div class="pull-left image"> <img src="http://bootdey.com/img/Content/user_1.jpg" class="img-circle avatar" alt="user profile image"> </div> <div class="pull-left name"> <h1 ng-if="vm.hasAccess">{{vm.user.firstname }} {{vm.user.lastname}}</h1> <h1 ng-if="!vm.hasAccess">Please login to leave a comment</h1> </div> </div> <div class="userComment"> <textarea required class="comment" ng-model="vm.reply" placeholder="Leave a reply" ng-readonly="!vm.hasAccess"></textarea> <button ng-disabled="!vm.hasAccess" type="submit" class="btn btn-success green pull-right"><i class="fa fa-share"></i> Reply</button> </div> </form> </div> </div> <div class="panel panel-white post panel-shadow" ng-repeat=" reply in comment.replies | orderObjectBy:\'date\':true"> <div class="post-heading"> <div class="pull-left image"> <img src="http://bootdey.com/img/Content/user_1.jpg" class="img-circle avatar" alt="user profile image "> </div> <div class="pull-left meta"> <div class="title h5"> <a href="#"><b>{{reply.user}}</b></a> made a post. </div> <h6 class="text-muted time">{{reply.date | date}}</h6> </div> </div> <div class="post-description"> <p>{{reply.reply}}</p> <div class="stats"> <a href="#" class="btn btn-default stat-item"> <i class="fa fa-thumbs-up icon"></i>2 </a> <a href="#" class="btn btn-default stat-item"> <i class="fa fa-thumbs-down icon"></i>12 </a> <a class="btn btn-primary" data-toggle="collapse" data-target="#{{$index}}" class="accordion-toggle"> REPLY </a> <div class="collapse" id="{{$index}}"> <div class="post-comment"> <form name="replyForm" novalidate ng-submit="replyForm.$valid && vm.replyComment(vm.reply , comment._id);"> <div class="userPic"> <div class="pull-left image"> <img src="http://bootdey.com/img/Content/user_1.jpg" class="img-circle avatar" alt="user profile image"> </div> <div class="pull-left name"> <h1 ng-if="vm.hasAccess">{{vm.user.firstname }} {{vm.user.lastname}}</h1> <h1 ng-if="!vm.hasAccess">Please login to leave a comment</h1> </div> </div> <div class="userComment"> <textarea required class="comment" ng-model="vm.reply" placeholder="Leave a reply" ng-readonly="!vm.hasAccess"></textarea> <button ng-disabled="!vm.hasAccess" type="submit" class="btn btn-success green pull-right"><i class="fa fa-share"></i> Reply</button> </div> </form> </div> </div> </div> </div> </div> </div> </div> </div> </div> </div> <div class="col-md-4"> <div class="side-wrapper"> <div class="popular-posts"> <h2>POPULAR POSTS</h2> <ul> <li> <a href="">What is Lorem Ipsum?</a> </li> <li> <a href="">Why do we use it?</a> </li> <li> <a href="">Where does it come from?</a> </li> <li> <a href="">Where can I get some?</a> </li> <li> <a href="">The standard Lorem Ipsum passage, used since the 1500s</a> </li> <li> <a href="">Section 1.10.32 of "de Finibus Bonorum et Malorum ", written by Cicero in 45 BC</a> </li> </ul> </div> </div> </div></div>'),a.put("views/home.html",'<div class="row main-wrapper"> <div class="col-md-8"> <div class="post-wrapper"> <div class="post" ng-repeat="blog in vm.blogs | orderObjectBy:\'date\':true"> <h2 class="post-title">{{blog.title}}</h2> <div class="post-meta"> <span>Created at:</span> <span class="post-date">{{blog.date | date}}</span> </div> <div ng-if="blog.tags" class="post-tags"> <span ng-repeat="tag in blog.tags">{{tag}}</span> </div> <div class="post-content"> <p>{{blog.content}}</p> </div> <div class="post-more"> <a class="btn btn-primary read-more" ng-click="open()" ui-sref="blogpost({id:blog._id})">Read More</a> </div> </div> </div> </div> <div class="col-md-4"> <div class="side-wrapper"> <div class="popular-posts"> <h2>POPULAR POSTS</h2> <ul> <li> <a href="">What is Lorem Ipsum?</a> </li> <li> <a href="">Why do we use it?</a> </li> <li> <a href="">Where does it come from?</a> </li> <li> <a href="">Where can I get some?</a> </li> <li> <a href="">The standard Lorem Ipsum passage, used since the 1500s</a> </li> <li> <a href="">Section 1.10.32 of "de Finibus Bonorum et Malorum", written by Cicero in 45 BC</a> </li> </ul> </div> </div> </div> </div>'),a.put("views/login.html",""),a.put("views/writeblog.html",'<div class="writeBlog" ng-controller="BlogCtrl as vm"> <h1>Write Blog</h1> <div class="container"> <div class="row"> <div class="col-md-12"> <form name="blogForm" novalidate ng-submit="blogForm.$valid && vm.createBlog(vm.title,vm.tags,vm.content)"> <div class="input-group"> <span class="input-group-addon" id="basic-addon1">Title</span> <input type="text" class="form-control" name="title" ng-model="vm.title" placeholder="PLace your title here" aria-describedby="basic-addon1" required> <span class="errors" ng-show="blogForm.title.$error.required && blogForm.$submitted">Enter the title </span> </div> <br> <div class="input-group"> <span class="input-group-addon" id="basic-addon2">Tags</span> <input type="text" class="form-control" name="tags" ng-model="vm.tags" placeholder="Enter the tags separated by commas" aria-describedby="basic-addon2" required> <span class="errors" ng-show="blogForm.tags.$error.required && blogForm.$submitted">Enter the tags </span> </div> <br> <div class="input-group"> <textarea class="form-control" style="min-width: 100%" name="content" ng-model="vm.content" placeholder="place your content here" required></textarea> <span class="errors" ng-show="blogForm.content.$error.required && blogForm.$submitted">Enter the content </span> </div> <br> <div class="input-group"> <button tabindex="-1" class="btn btn-default" type="submit">Submit</button> </div> </form> </div> </div> </div> </div>')}]);